(* Remote I/O Protocol support for GNU Modula-2 programs running on Linux      *)
(* computers, using libremoteio.so and libsimpleio.so.                         *)
(*                                                                             *)
(* http://git.munts.com/libsimpleio/doc/RemoteIOProtocol.pdf                   *)

(* Copyright (C)2023, Philip Munts dba Munts Technologies.                     *)
(*                                                                             *)
(* Redistribution and use in source and binary forms, with or without          *)
(* modification, are permitted provided that the following conditions are met: *)
(*                                                                             *)
(* * Redistributions of source code must retain the above copyright notice,    *)
(*   this list of conditions and the following disclaimer.                     *)
(*                                                                             *)
(* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" *)
(* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE   *)
(* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  *)
(* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE   *)
(* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR         *)
(* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF        *)
(* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS    *)
(* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN     *)
(* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)     *)
(* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE  *)
(* POSSIBILITY OF SUCH DAMAGE.                                                 *)

DEFINITION MODULE FOR "C" libremoteio;

  FROM Channel   IMPORT Channels;
  FROM message64 IMPORT Message;
  FROM SYSTEM    IMPORT BYTE;

  EXPORT UNQUALIFIED
    TIMEOUT_FOREVER,
    TIMEOUT_NEVER,
    TIMEOUT_DEFAULT,
    open_hid,
    open_serial,
    open_udp,
    send,
    receive,
    get_version,
    get_capability,
    adc_channels,
    dac_channels,
    gpio_channels,
    i2c_channels,
    pwm_channels,
    spi_channels;

  CONST
    TIMEOUT_FOREVER = -1;
    TIMEOUT_NEVER   = 0;
    TIMEOUT_DEFAULT = 1000; (* milliseconds *)

  PROCEDURE open_hid
   (vid          : CARDINAL;
    pid          : CARDINAL;
    serial       : ARRAY OF CHAR;
    timeout      : INTEGER;
    VAR handle   : INTEGER;
    VAR error    : INTEGER);

  PROCEDURE open_serial
   (portname     : ARRAY OF CHAR;
    baudrate     : INTEGER;
    timeout      : INTEGER;
    VAR handle   : INTEGER;
    VAR error    : INTEGER);

  PROCEDURE open_udp
   (server       : ARRAY OF CHAR;
    port         : CARDINAL;
    timeout      : INTEGER;
    VAR handle   : INTEGER;
    VAR error    : INTEGER);

  PROCEDURE send
   (handle       : INTEGER;
    VAR cmd      : Message;
    VAR error    : INTEGER);

  PROCEDURE receive
   (handle       : INTEGER;
    VAR resp     : Message;
    VAR error    : INTEGER);

  PROCEDURE get_version
   (handle       : INTEGER;
    VAR inbuf    : ARRAY OF CHAR;
    VAR error    : INTEGER);

  PROCEDURE get_capability
   (handle       : INTEGER;
    VAR inbuf    : ARRAY OF CHAR;
    VAR error    : INTEGER);

  PROCEDURE adc_channels
   (handle       : INTEGER;
    VAR channels : Channels;
    VAR error    : INTEGER);

  PROCEDURE dac_channels
   (handle       : INTEGER;
    VAR channels : Channels;
    VAR error    : INTEGER);

  PROCEDURE gpio_channels
   (handle       : INTEGER;
    VAR channels : Channels;
    VAR error    : INTEGER);

  PROCEDURE i2c_channels
   (handle       : INTEGER;
    VAR channels : Channels;
    VAR error    : INTEGER);

  PROCEDURE pwm_channels
   (handle       : INTEGER;
    VAR channels : Channels;
    VAR error    : INTEGER);

  PROCEDURE spi_channels
   (handle       : INTEGER;
    VAR channels : Channels;
    VAR error    : INTEGER);

END libremoteio.
